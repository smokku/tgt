# version info
MAJOR = 0
MINOR = 06
PATCHLEVEL = 0
EXTRAVERSION =

LIB = libngtk.so.$(MAJOR).$(MINOR).$(PATCHLEVEL)


# platform info
ARCH = 486
TOPDIR = `pwd`
PREFIX = /usr

INCLUDE = include/ngtk.h


# compiler options
CC = gcc
OPTFLAGS = -s -O2 -m$(ARCH)	# optimize and strip flags
#OPTFLAGS = -g3 -m$(ARCH)	# debug flags
CONTEXT_FLAGS = -D_REENTRANT -DHAVE_SLANG
CFLAGS = $(OPTFLAGS) -Wall -fPIC $(CONTEXT_FLAGS) -Iinclude


# linker options
LD = gcc
CONTEXT_LIBS = -lpthread -lslang
LIBS = -lncurses -lpanel $(CONTEXT_LIBS)
LIBFLAGS = -shared -Wl,-soname,libngtk.so.$(MAJOR) $(LIBS)


# generated objs list
OBJS = src/ngtk_bars.o src/ngtk_boxes.o src/ngtk_fade.o \
src/ngtk_getxtbox.o src/ngtk_init.o src/ngtk_input.o \
src/ngtk_input_thread.o src/ngtk_menu.o src/ngtk_omnibox.o \
src/ngtk_pbar.o src/ngtk_radio.o src/ngtk_readline.o src/ngtk_scroll.o \
src/ngtk_slang.o src/ngtk_stdbox.o src/ngtk_strings.o src/ngtk_utils.o \
src/ngtk_winstack.o src/ngtk_yesno.o


# general compilation rule
%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# build targets
default: $(LIB)

$(LIB): $(OBJS)
	$(LD) $(LIBFLAGS) -o $(LIB) $(OBJS)


# test programs
test: install
	cd test
	make -C ./test
	cd ..

ngtkdialog: install
	cd ngtkdialog
	make -C ./ngtkdialog
	cd ..


# man pages generation
man: 
	cd man
	make -C ./man
	cd ..


# installation
install_lib: $(LIB)
	ln -sf $(PREFIX)/lib/libngtk.so.$(MAJOR) $(PREFIX)/lib/libngtk.so
	ln -sf $(PREFIX)/lib/$(LIB) $(PREFIX)/lib/libngtk.so.$(MAJOR)
	-cp $(LIB) $(PREFIX)/lib

install_devel: $(INCLUDE)
	mkdir -p $(PREFIX)/include/ngtk
	-cp -f include/ngtk.h $(PREFIX)/include/ngtk

install: install_lib install_devel


# uninstallation
uninstall_lib:
	-rm -f $(PREFIX)/lib/libngtk.so*

uninstall_devel:
	-rm -rf $(PREFIX)/include/ngtk

uninstall: uninstall_lib uninstall_devel

clean:
	-rm -f $(OBJS) $(LIB)
	cd test
	make -C ./test clean
	cd ..
	cd ngtkdialog
	make -C ./ngtkdialog clean
	cd ..

# this one cleans the source tree and uninstalls the library and includes
clean_all: clean uninstall
